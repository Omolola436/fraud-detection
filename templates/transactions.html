{% extends "base.html" %}

{% block content %}
<div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
        <h3 class="text-lg font-semibold text-gray-900">All Transactions</h3>
        <div class="flex gap-2">
            <input type="text" placeholder="Search ID or Merchant..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-orange-500">
            <button class="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200">Filter</button>
        </div>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-left">
            <thead class="bg-gray-50 text-gray-500 text-xs uppercase">
                <tr>
                    <th class="px-6 py-3 font-medium">Time</th>
                    <th class="px-6 py-3 font-medium">Transaction ID</th>
                    <th class="px-6 py-3 font-medium">Merchant</th>
                    <th class="px-6 py-3 font-medium">Amount</th>
                    <th class="px-6 py-3 font-medium">Risk Score</th>
                    <th class="px-6 py-3 font-medium">Status</th>
                    <th class="px-6 py-3 font-medium">Action</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 text-sm" id="all-txn-table-body">
                <!-- Rows injected by JS -->
            </tbody>
        </table>
    </div>
    <div class="px-6 py-4 border-t border-gray-200 flex justify-between items-center">
        <span class="text-sm text-gray-500">Showing 10 of 1243</span>
        <div class="flex gap-2">
            <button class="px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50">Previous</button>
            <button class="px-3 py-1 border border-gray-300 rounded text-sm">Next</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/api/data')
            .then(response => response.json())
            .then(data => {
                const tbody = document.getElementById('all-txn-table-body');
                tbody.innerHTML = '';
                
                data.transactions.forEach(txn => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 cursor-pointer transition-colors';
                    
                    // Risk Score Color
                    let riskColor = 'text-green-600 bg-green-50';
                    if (txn.risk_score > 80) riskColor = 'text-red-600 bg-red-50 font-bold';
                    else if (txn.risk_score > 50) riskColor = 'text-orange-600 bg-orange-50';

                    // Status Color
                    let statusColor = 'bg-gray-100 text-gray-800';
                    if (txn.status === 'Approved') statusColor = 'bg-green-100 text-green-800';
                    if (txn.status === 'Declined') statusColor = 'bg-red-100 text-red-800';
                    if (txn.status === 'Flagged') statusColor = 'bg-orange-100 text-orange-800';
                    if (txn.status === 'Review') statusColor = 'bg-yellow-100 text-yellow-800';

                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-gray-500">${txn.time}</td>
                        <td class="px-6 py-4 font-mono text-xs text-gray-600">${txn.id}</td>
                        <td class="px-6 py-4 font-medium text-gray-900">${txn.merchant}</td>
                        <td class="px-6 py-4 text-gray-900">$${txn.amount.toFixed(2)}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${riskColor}" title="Fraud Probability">
                                ${txn.risk_score}/100
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColor}">
                                ${txn.status}
                            </span>
                        </td>
                         <td class="px-6 py-4">
                            <button class="text-blue-600 hover:text-blue-800 text-xs font-medium">Details</button>
                        </td>
                    `;
                    row.onclick = () => alert(`Viewing details for transaction ${txn.id}`);
                    tbody.appendChild(row);
                });
            });
    });
</script>
{% endblock %}
